
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enigma-Apex Risk Dashboard</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #0a0a0a; color: #fff; }
        
        .header { background: linear-gradient(135deg, #1a1a1a, #2a2a2a); padding: 20px; text-align: center; border-bottom: 2px solid #00ff88; }
        .header h1 { color: #00ff88; font-size: 2.5em; margin-bottom: 10px; }
        .header p { color: #ccc; font-size: 1.1em; }
        
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        
        .metrics-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .metric-card { background: linear-gradient(135deg, #1a1a1a, #2a2a2a); padding: 20px; border-radius: 10px; border: 1px solid #333; }
        .metric-card h3 { color: #00ff88; margin-bottom: 10px; font-size: 0.9em; text-transform: uppercase; }
        .metric-value { font-size: 2em; font-weight: bold; margin-bottom: 5px; }
        .metric-change { font-size: 0.9em; opacity: 0.8; }
        
        .positive { color: #00ff88; }
        .negative { color: #ff4444; }
        .neutral { color: #ffaa00; }
        
        .dashboard-grid { display: grid; grid-template-columns: 2fr 1fr; gap: 30px; }
        .panel { background: linear-gradient(135deg, #1a1a1a, #2a2a2a); padding: 20px; border-radius: 10px; border: 1px solid #333; }
        .panel h2 { color: #00ff88; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 1px solid #333; }
        
        .signals-table { width: 100%; border-collapse: collapse; }
        .signals-table th, .signals-table td { padding: 12px 8px; text-align: left; border-bottom: 1px solid #333; }
        .signals-table th { background: #333; color: #00ff88; font-weight: bold; }
        .signals-table tr:hover { background: #2a2a2a; }
        
        .signal-bullish { color: #00ff88; }
        .signal-bearish { color: #ff4444; }
        
        .power-score { font-weight: bold; }
        .confidence-c1 { color: #ffaa00; }
        .confidence-c2 { color: #00aaff; }
        .confidence-c3 { color: #00ff88; }
        
        .status-indicator { display: inline-block; width: 12px; height: 12px; border-radius: 50%; margin-right: 8px; }
        .status-connected { background: #00ff88; }
        .status-disconnected { background: #ff4444; }
        
        .refresh-btn { background: #00ff88; color: #000; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .refresh-btn:hover { background: #00cc6a; }
        
        .last-updated { color: #888; font-size: 0.8em; margin-top: 10px; }
        
        @media (max-width: 1024px) {
            .dashboard-grid { grid-template-columns: 1fr; }
            .metrics-grid { grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üõ°Ô∏è Enigma-Apex Risk Dashboard</h1>
        <p>Real-time Trading Risk Management & Performance Monitoring</p>
    </div>
    
    <div class="container">
        <!-- Account Metrics -->
        <div class="metrics-grid">
            <div class="metric-card">
                <h3>üí∞ Account Balance</h3>
                <div class="metric-value">${{ "{:,.2f}".format(account_summary.account_balance) }}</div>
                <div class="metric-change">Current Balance</div>
            </div>
            
            <div class="metric-card">
                <h3>üìà Daily P&L</h3>
                <div class="metric-value {{ 'positive' if account_summary.daily_pnl >= 0 else 'negative' }}">
                    ${{ "{:+,.2f}".format(account_summary.daily_pnl) }}
                </div>
                <div class="metric-change">Today's Performance</div>
            </div>
            
            <div class="metric-card">
                <h3>üìâ Current Drawdown</h3>
                <div class="metric-value {{ 'positive' if account_summary.current_drawdown <= 5 else 'negative' }}">
                    {{ "{:.2f}".format(account_summary.current_drawdown) }}%
                </div>
                <div class="metric-change">Maximum Drawdown</div>
            </div>
            
            <div class="metric-card">
                <h3>üéØ Risk Score</h3>
                <div class="metric-value {{ 'positive' if account_summary.risk_score <= 50 else 'negative' }}">
                    {{ account_summary.risk_score }}/100
                </div>
                <div class="metric-change">Risk Level</div>
            </div>
            
            <div class="metric-card">
                <h3>üìä Total Signals</h3>
                <div class="metric-value">{{ account_summary.total_signals }}</div>
                <div class="metric-change">All Time</div>
            </div>
            
            <div class="metric-card">
                <h3>üîÑ Signals Today</h3>
                <div class="metric-value">{{ account_summary.signals_today }}</div>
                <div class="metric-change">Last 24 Hours</div>
            </div>
        </div>
        
        <div class="dashboard-grid">
            <!-- Recent Signals -->
            <div class="panel">
                <h2>üìä Recent Trading Signals</h2>
                <button class="refresh-btn" onclick="refreshData()">üîÑ Refresh</button>
                
                <table class="signals-table">
                    <thead>
                        <tr>
                            <th>Type</th>
                            <th>Power</th>
                            <th>Confidence</th>
                            <th>Symbol</th>
                            <th>Timeframe</th>
                            <th>Source</th>
                            <th>Time</th>
                        </tr>
                    </thead>
                    <tbody id="signals-tbody">
                        {% for signal in recent_signals %}
                        <tr>
                            <td class="signal-{{ signal.signal_type }}">
                                {{ 'üü¢ BULL' if signal.signal_type == 'bullish' else 'üî¥ BEAR' }}
                            </td>
                            <td class="power-score">{{ signal.power_score }}%</td>
                            <td class="confidence-{{ signal.confidence.lower() }}">{{ signal.confidence }}</td>
                            <td>{{ signal.symbol }}</td>
                            <td>{{ signal.timeframe }}</td>
                            <td>{{ signal.source[:10] }}...</td>
                            <td>{{ signal.timestamp[:19].replace('T', ' ') }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            
            <!-- System Status -->
            <div class="panel">
                <h2>üîß System Status</h2>
                
                <div style="margin-bottom: 20px;">
                    <h4><span class="status-indicator status-connected"></span>WebSocket Server</h4>
                    <p>Connected and operational</p>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <h4><span class="status-indicator status-connected"></span>Database</h4>
                    <p>Logging all transactions</p>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <h4><span class="status-indicator status-connected"></span>Risk Manager</h4>
                    <p>Active monitoring</p>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <h4><span class="status-indicator status-connected"></span>Signal Processing</h4>
                    <p>Real-time analysis</p>
                </div>
                
                <h3 style="color: #00ff88; margin-top: 30px;">Quick Actions</h3>
                <div style="margin-top: 15px;">
                    <a href="http://localhost:5000" target="_blank" style="display: inline-block; background: #333; color: #fff; padding: 10px 15px; text-decoration: none; border-radius: 5px; margin-right: 10px;">üì§ Manual Signals</a>
                    <button onclick="refreshData()" style="background: #333; color: #fff; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer;">üîÑ Refresh All</button>
                </div>
            </div>
        </div>
        
        <div class="last-updated">
            Last Updated: {{ account_summary.last_updated.replace('T', ' ')[:19] }}
        </div>
    </div>
    
    <script>
        function refreshData() {
            location.reload();
        }
        
        // Auto-refresh every 30 seconds
        setInterval(refreshData, 30000);
        
        // Update signals table periodically
        async function updateSignals() {
            try {
                const response = await fetch('/api/recent_signals?limit=10');
                const signals = await response.json();
                
                const tbody = document.getElementById('signals-tbody');
                tbody.innerHTML = '';
                
                signals.forEach(signal => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td class="signal-${signal.signal_type}">
                            ${signal.signal_type === 'bullish' ? 'üü¢ BULL' : 'üî¥ BEAR'}
                        </td>
                        <td class="power-score">${signal.power_score}%</td>
                        <td class="confidence-${signal.confidence.toLowerCase()}">${signal.confidence}</td>
                        <td>${signal.symbol}</td>
                        <td>${signal.timeframe}</td>
                        <td>${signal.source.substring(0, 10)}...</td>
                        <td>${signal.timestamp.substring(0, 19).replace('T', ' ')}</td>
                    `;
                    tbody.appendChild(row);
                });
            } catch (error) {
                console.error('Failed to update signals:', error);
            }
        }
        
        // Update signals every 10 seconds
        setInterval(updateSignals, 10000);
    </script>
</body>
</html>
    